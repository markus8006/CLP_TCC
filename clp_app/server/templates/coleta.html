{% extends "base.html" %}

{% block title %}Coleta de IPS{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/coleta.css') }}">
{% endblock %}

{% block content %}

<div class="container_clps">
    <h1>Coleta de IPS</h1>
    {% if status == "desativado" %}
        <span class="status_offline">Status: Desativado</span>
        <a href="{{ url_for('alterar_coleta_ips') }}" class="teste">Ativar</a>
    {% else %}
        <span class="status_online">Status: Ativado</span>
        <a href="{{ url_for('alterar_coleta_ips') }}" class="teste">Desativar</a>
    {% endif %}
</div>

<div class="container_clps">
    <h2>Histórico</h2>
    <button onclick="limparLogs()">Limpar logs</button>
    <button>Limpar Registros</button>
    
    <div id="logs-container" class="logs-container">
        <table>
            <thead>
                <tr>
                    <th>Hora</th>
                    <th>Nível</th>
                    <th>Mensagem</th>
                </tr>
            </thead>
            <tbody id="log-table-body">
                {% for log in logs %}
                <tr>
                    <td>{{ log.hora }}</td>
                    <td>{{ log.nivel }}</td>
                    <td>{{ log.mensagem }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}

{% block scripts %}

<script>
    /**
     * Função que adiciona uma nova linha de log na tabela e rola para o final.
     */
    function adicionarNovoLog(log) {
        const corpoTabela = document.getElementById('log-table-body');
        const novaLinha = document.createElement('tr');

        // Preenche a nova linha com os dados do log
        novaLinha.innerHTML = `
            <td>${log.hora}</td>
            <td>${log.nivel}</td>
            <td>${log.mensagem}</td>
        `;
        
        // Adiciona a nova linha ao final da tabela
        corpoTabela.appendChild(novaLinha);

        // --- MELHORIA: Auto-scroll para o final ---
        const container = document.getElementById('logs-container');
        container.scrollTop = container.scrollHeight;
    }

    /**
     * Função para limpar os logs da tabela.
     */
    function limparLogs() {
        const corpoTabela = document.getElementById('log-table-body');
        corpoTabela.innerHTML = ''; // Remove todas as linhas
        console.log("Logs limpos da tela.");
    }


</script>
{% endblock %}